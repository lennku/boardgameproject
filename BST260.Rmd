----
title: "260Project_Chen"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(dslabs)
library(tidyverse)
library(dplyr)
ds_theme_set()

#game <- read.csv(file = file.choose()) #4999   20

game <- read.csv('bgg_db_2017_04.csv', header = TRUE)
names(game)
summary(game)
```

1.	Model via stepwise elimination the best predictors of a good board game (based on game rating)
2.	Compare if model differs for avg rating vs geek rating
3.	
4.	Explore any interesting correlation between the covariates
5.	Test if we can accurately predict the rating of board games based on our model (https://boardgamegeek.com/browse/boardgame)
6.	Play the best/worst game ourselves to see if we agree :P (maybe)
7.	Design our own game based on findings (maybe)


### EDA
#1 ) missting value?
```{r}
missing(game) #none
```
 
#2) Relationship between geek_rating and avg_rating?
```{r}
game %>% ggplot(aes(geek_rating, avg_rating)) +
  geom_point(alpha = 0.8) +
   geom_smooth()
```

Seems that the ave_rating is higher than geek_rating in general (geeks seem more critical)

#3) Explore the distribution of our covariates in this dataset
```{r}
game %>% ggplot(aes(avg_time))+
  geom_histogram(bins = 100) 
```


```{r}
game %>% ggplot(aes(avg_time))+
  geom_histogram()+
  scale_x_continuous(trans = "log2") 
```

# Check the category variable - the avg_rating distribution across the categories
# list the board games that are the most highly rated
```{r}
library(purrr)
#data$cat <-as.character(data$category)
#data$cat <- str_split(cat, ',')
#cateogry <- do.call(rbind,catsplit)

#split funtion
split_into_multiple <- function(column, pattern = ", ", into_prefix){
  cols <- str_split_fixed(column, pattern, n = Inf)
  # Sub out the ""'s returned by filling the matrix to the right, with NAs which are useful
  cols[which(cols == "")] <- NA
  cols <- as.tibble(cols)
  # name the 'cols' tibble as 'into_prefix_1', 'into_prefix_2', ..., 'into_prefix_m' 
  # where m = # columns of 'cols'
  m <- dim(cols)[2]

  names(cols) <- paste(into_prefix, 1:m, sep = "_")
  return(cols)
}

# Check the category variable - the avg_rating distribution across the categories
# list the board games that are the most highly rated
d <- game %>% 
  select(rank, category, avg_rating) %>%
  bind_cols(split_into_multiple(game$category,',','category'))

d1 <- d %>% 
  select(-category, -rank) %>%
  gather(key, val, -avg_rating, na.rm = T)

d2 <- d1 %>% group_by(val) %>% summarise(average_rating = mean (avg_rating)) 

d2 %>% ggplot(aes(val, y = average_rating))+
  geom_point(size=0.1)+
  theme(text = element_text(size=5),
        axis.text.x = element_text(angle = 90, hjust =0))
 
```


```{r}
# Check the mechanic variable - the avg_rating distribution across the mechanic cat
# list the board games that are the most highly rated
mechanic <- game %>% 
  select(rank, mechanic, avg_rating) %>%
  bind_cols(split_into_multiple(game$mechanic,',','mechanic'))

mechanic1 <- mechanic %>% 
  select(-mechanic, -rank) %>%
  gather(key, val, -avg_rating, na.rm = T)

mechanic2 <- mechanic1 %>% group_by(val) %>% summarise(average_rating = mean (avg_rating)) 

mechanic2 %>% ggplot(aes(val, y = average_rating))+
  geom_point(size=0.1)+
  theme(text = element_text(size=5),
        axis.text.x = element_text(angle = 90, hjust =0))
```
```{r}
arrange(mechanic2, desc(mechanic2$average_rating))
```

```{r}
# Check the designer variable - the avg_rating distribution across the designer variable (too many, overlapped plots not informative)
# list the board games that are the most highly rated
designer <- game %>% 
  select(rank, designer, avg_rating) %>%
  bind_cols(split_into_multiple(game$designer,',','designer'))

designer1 <- designer %>% 
  select(-designer, -rank) %>%
  gather(key, val, -avg_rating, na.rm = T)

designer2 <- designer1 %>% group_by(val) %>% summarise(average_rating = mean (avg_rating)) 

designer2 %>% ggplot(aes(val, y = average_rating))+
  geom_point(size=0.1)+
  theme(text = element_text(size=5),
        axis.text.x = element_text(angle = 90, hjust =0))
```

```{r}
arrange(designer2, desc(designer2$average_rating))
```

# descriptive analysis of covariates (plots)
```{r}
# the distribution of avg_rating across years
game %>% group_by(year) %>%
  filter(year > 0) %>%
  summarise(mean_rating = mean(avg_rating)) %>%
  ggplot(aes(year, mean_rating))+
  ggtitle('the distribution of avg_rating across years')+
  geom_point()
  
```

```{r}
# the distribution of geek_rating across years
game %>% group_by(year) %>%
  filter(year > 0) %>%
  summarise(geek_mean = mean(geek_rating)) %>%
  ggplot(aes(year,geek_mean))+
  ggtitle('the distribution of geek_mean across years')+
  geom_point()
```



```{r}
# the distribution of num_votes across years
game %>% group_by(year) %>%
  filter(year > 0) %>%
  summarise(sum = sum(num_votes)) %>%
  ggplot(aes(year, sum))+
  geom_point()+
  ggtitle('the distribution of num_votes across years')
```

```{r}
# the distribution of owned across years
game %>% group_by(year) %>%
  filter(year > 0) %>%
  summarise(sum = sum( owned)) %>%
  ggplot(aes(year, sum))+
  geom_point()+
  ggtitle('the distribution of owned across years')
```

```{r}
# the distribution of weights across years
game %>% group_by(year) %>%
  filter(year > 0) %>%
  summarise(m = mean(weight)) %>%
  ggplot(aes(year, m))+
  geom_point()+
  ggtitle('the distribution of mean weight of board games across years')
```

```{r}
# the distribution of ranks across years
game %>% group_by(year) %>%
  filter(year > 0) %>%
  summarise(m = mean(rank)) %>%
  ggplot(aes(year, m))+
  geom_point()+
  ggtitle('the distribution of mean rank of board games across years')
```

```{r}
rank <- game %>% group_by(year) %>%
  filter(year > 0) %>%
  summarise(m = mean(rank))

top_n(rank,10, wt = 2)
arrange(rank, desc(rank$mean_rank))
```

